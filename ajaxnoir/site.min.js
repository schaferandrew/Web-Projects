/*! ajaxnoir 2018-04-24 */

function Login(i){console.log("Login constructed");var t=$(i);t.submit(function(e){e.preventDefault(),console.log("Submitted"),$.ajax({url:"post/login.php",data:t.serialize(),method:"POST",success:function(e){var t=parse_json(e);console.log(t),t.ok?window.location.assign("./"):$(i+" .message").html("<p>"+t.message+"</p>")},error:function(e,t,o){$(i+" .message").html("<p>Error: "+o+"</p>")}})})}function MovieInfo(o,e,t){console.log("MovieInfo: "+e+"/"+t);var i=this;$.ajax({url:"https://api.themoviedb.org/3/search/movie",data:{api_key:"0745db42af2e54202e8cd16ec79e25bc",query:e,year:t},method:"GET",dataType:"text",success:function(e){var t=parse_json(e);0==t.total_results?$(".paper").html("<p>No information available</p>"):(console.log(t.results[0]),i.present(o,t.results[0]))},error:function(e,t,o){$(".paper").html("<p>Unable to communicate<br>with themoviedb.org</p>")}})}function parse_json(t){try{var e=$.parseJSON(t)}catch(e){throw"JSON parse error: "+t}return e}function Stars(e){console.log("Stars constructor");for(var t=$(e+" table").find("tr"),o=1;o<t.length;o++)for(var i=$(t.get(o)),a=i.find('input[name="id"]').val(),s=i.find("img"),n=0;n<s.length;n++){var r=$(s.get(n));this.installListener(i,r,a,n+1)}}MovieInfo.prototype.present=function(e,t){var o="<ul><li id='info'><a id='infoLink' href='#'><img src='images/info.png'></a><div class='show'><p>Title: "+t.title+"</p><p>Release Date: "+t.release_date+"</p><p>Vote Average: "+t.vote_average+"</p><p>Vote Count: "+t.vote_count+"</p></div></li><li id='plot'><a id='plotLink' href='#'><img src='images/plot.png'></a><div><p>"+t.overview+"</p></div></li><li id='poster'><a id='posterLink' href='#'><img src='images/poster.png'></a><div><p class='poster'><img id='poster' src=''></p></div></li></ul>";$(e).html(o),$("img#poster").attr("src","http://image.tmdb.org/t/p/w500/"+t.poster_path),$("#infoLink").click(function(){console.log("clicked on info link"),$("#infoLink > img").css("opacity",1),$("#plotLink > img").css("opacity",.3),$("#posterLink > img").css("opacity",.3),$("li#plot > div").fadeOut(1e3),$("li#poster > div").fadeOut(1e3),$("li#info > div").fadeIn(1e3)}),$("#plotLink").click(function(){console.log("clicked on plot"),$("#infoLink > img").css("opacity",.3),$("#plotLink > img").css("opacity",1),$("#posterLink > img").css("opacity",.3),$("li#info > div").fadeOut(1e3),$("li#poster > div").fadeOut(1e3),$("li#plot > div").fadeIn(1e3)}),$("#posterLink").click(function(){console.log("clicked on poster"),$("#infoLink > img").css("opacity",.3),$("#plotLink > img").css("opacity",.3),$("#posterLink > img").css("opacity",1),$("li#info > div").fadeOut(1e3),$("li#plot > div").fadeOut(1e3),$("li#poster > div").fadeIn(1e3)})},Stars.prototype.installListener=function(o,e,t,i){var a=this;e.click(function(){console.log("Click on "+t+" rating: "+i),$.ajax({url:"post/stars.php",data:{id:t,rating:i},method:"POST",success:function(e){var t=parse_json(e);t.ok?(a.update(o,i),a.updateTable(t.html),a.message("<p>Successfully updated</p>")):a.message("<p>Update failed</p>")},error:function(e,t,o){a.message("<p>Error: "+o+"</p>")}})})},Stars.prototype.update=function(e,t){for(var o=e.find("img"),i=0;i<o.length;i++){var a=$(o.get(i));i<t?a.attr("src","images/star-green.png"):a.attr("src","images/star-gray.png")}e.find("span.num").text(t+"/10")},Stars.prototype.message=function(e){$(".message").html(e).show().delay(2e3).fadeIn(1e3).fadeOut(1e3)},Stars.prototype.updateTable=function(e){$(".table").html(e),console.log("update table was called")};